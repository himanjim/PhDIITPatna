---
# Hyperledger Fabric v3.1.1
# Application-channel genesis for Channel Participation API (no system channel).
# - NO global Orderer.Addresses (V3_0 forbids it)
# - Per-orderer-org OrdererEndpoints instead
# - Raft (etcdraft) with 5 consenters
# - Orderer group includes BlockValidation policy
# - EACH orderer org defines Policies (required)

Organizations:

  # -------- ORDERER ORGS (with Policies + OrdererEndpoints) --------
  - &ECI1
    Name: ECI1
    ID: ECI1MSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/eci1.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('ECI1MSP.member')" }
      Writers: { Type: Signature, Rule: "OR('ECI1MSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('ECI1MSP.admin')" }
    OrdererEndpoints:
      - orderer1.eci1.bench.local:7050

  - &ECI2
    Name: ECI2
    ID: ECI2MSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/eci2.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('ECI2MSP.member')" }
      Writers: { Type: Signature, Rule: "OR('ECI2MSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('ECI2MSP.admin')" }
    OrdererEndpoints:
      - orderer2.eci2.bench.local:8050

  - &OPP1
    Name: OPP1
    ID: OPP1MSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/opp1.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('OPP1MSP.member')" }
      Writers: { Type: Signature, Rule: "OR('OPP1MSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('OPP1MSP.admin')" }
    OrdererEndpoints:
      - orderer3.opp1.bench.local:9050

  - &OPP2
    Name: OPP2
    ID: OPP2MSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/opp2.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('OPP2MSP.member')" }
      Writers: { Type: Signature, Rule: "OR('OPP2MSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('OPP2MSP.admin')" }
    OrdererEndpoints:
      - orderer4.opp2.bench.local:10050

  - &CIV1
    Name: CIV1
    ID: CIV1MSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/civ1.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('CIV1MSP.member')" }
      Writers: { Type: Signature, Rule: "OR('CIV1MSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('CIV1MSP.admin')" }
    OrdererEndpoints:
      - orderer5.civ1.bench.local:11050

  # ---------------- APPLICATION ORGS ----------------
  - &ECIAPP
    Name: ECIMSP
    ID: ECIMSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/peerOrganizations/eci.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('ECIMSP.member')" }
      Writers: { Type: Signature, Rule: "OR('ECIMSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('ECIMSP.admin')" }
      Endorsement: { Type: Signature, Rule: "OR('ECIMSP.peer')" }

  - &OPPAPP
    Name: OppMSP
    ID: OppMSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/peerOrganizations/opp.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('OppMSP.member')" }
      Writers: { Type: Signature, Rule: "OR('OppMSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('OppMSP.admin')" }
      Endorsement: { Type: Signature, Rule: "OR('OppMSP.peer')" }

  - &CIVAPP
    Name: CivilMSP
    ID: CivilMSP
    MSPDir: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/peerOrganizations/civil.bench.local/msp
    Policies:
      Readers: { Type: Signature, Rule: "OR('CivilMSP.member')" }
      Writers: { Type: Signature, Rule: "OR('CivilMSP.member')" }
      Admins:  { Type: Signature, Rule: "OR('CivilMSP.admin')" }
      Endorsement: { Type: Signature, Rule: "OR('CivilMSP.peer')" }

# ---------------- CAPABILITIES ----------------
Capabilities:
  Channel: &ChannelCaps
    V2_0: true
  Orderer: &OrdererCaps
    V2_0: true
  Application: &AppCaps
    V2_0: true

# ---------------- DEFAULTS ----------------
Application: &ApplicationDefaults
  Organizations:
  Policies:
    Readers: { Type: ImplicitMeta, Rule: "ANY Readers" }
    Writers: { Type: ImplicitMeta, Rule: "ANY Writers" }
    Admins:  { Type: ImplicitMeta, Rule: "MAJORITY Admins" }
    Endorsement:          { Type: ImplicitMeta, Rule: "MAJORITY Endorsement" }
    LifecycleEndorsement: { Type: ImplicitMeta, Rule: "MAJORITY Endorsement" }
  Capabilities:
    <<: *AppCaps

Orderer: &OrdererDefaults
  OrdererType: etcdraft
  # NOTE: No global 'Addresses:' with V3_0 + Participation API
  EtcdRaft:
    Consenters:
      - Host: orderer1.eci1.bench.local
        Port: 7050
        ClientTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/eci1.bench.local/orderers/orderer1.eci1.bench.local/tls/server.crt
        ServerTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/eci1.bench.local/orderers/orderer1.eci1.bench.local/tls/server.crt
      - Host: orderer2.eci2.bench.local
        Port: 8050
        ClientTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/eci2.bench.local/orderers/orderer2.eci2.bench.local/tls/server.crt
        ServerTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/eci2.bench.local/orderers/orderer2.eci2.bench.local/tls/server.crt
      - Host: orderer3.opp1.bench.local
        Port: 9050
        ClientTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/opp1.bench.local/orderers/orderer3.opp1.bench.local/tls/server.crt
        ServerTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/opp1.bench.local/orderers/orderer3.opp1.bench.local/tls/server.crt
      - Host: orderer4.opp2.bench.local
        Port: 10050
        ClientTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/opp2.bench.local/orderers/orderer4.opp2.bench.local/tls/server.crt
        ServerTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/opp2.bench.local/orderers/orderer4.opp2.bench.local/tls/server.crt
      - Host: orderer5.civ1.bench.local
        Port: 11050
        ClientTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/civ1.bench.local/orderers/orderer5.civ1.bench.local/tls/server.crt
        ServerTLSCert: /home/ubuntu/fab-election-bench/stacks/stack-v31-raft/crypto/ordererOrganizations/civ1.bench.local/orderers/orderer5.civ1.bench.local/tls/server.crt
  Organizations:
    - *ECI1
    - *ECI2
    - *OPP1
    - *OPP2
    - *CIV1
  Policies:
    Readers:         { Type: ImplicitMeta, Rule: "ANY Readers" }
    Writers:         { Type: ImplicitMeta, Rule: "ANY Writers" }
    Admins:          { Type: ImplicitMeta, Rule: "MAJORITY Admins" }
    BlockValidation: { Type: ImplicitMeta, Rule: "ANY Writers" }   # REQUIRED in v3.x
  Capabilities:
    <<: *OrdererCaps

Channel: &ChannelDefaults
  Policies:
    Readers: { Type: ImplicitMeta, Rule: "ANY Readers" }
    Writers: { Type: ImplicitMeta, Rule: "ANY Writers" }
    Admins:  { Type: ImplicitMeta, Rule: "MAJORITY Admins" }
  Capabilities:
    <<: *ChannelCaps

# ---------------- PROFILE ----------------
Profiles:
  RaftChannel:
    <<: *ChannelDefaults
    Orderer:
      <<: *OrdererDefaults
    Application:
      <<: *ApplicationDefaults
      Organizations:
        - *ECIAPP
        - *OPPAPP
        - *CIVAPP
      Capabilities:
        <<: *AppCaps

